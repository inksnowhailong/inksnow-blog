---
title: å¦‚ä½•è®©githubåˆ†æ”¯ä¸Šä¼ åï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨
date: 2024-12-23
categories:
  - ç¼–ç¨‹
tags:
  - å®éªŒ
---

æˆ‘æ›¾å‘è¿‡ä¸€ç¯‡ï¼Œå…³äºå¦‚ä½•éƒ¨ç½²ä¸€ä¸ªæˆ‘è¿™æ ·çš„åšå®¢ç½‘ç«™çš„æ–‡ç« [é“¾æ¥ğŸ”—](./é™æ€ç½‘ç«™éƒ¨ç½².md)
é‡Œé¢ä»‹ç»äº†æˆ‘ä½¿ç”¨çš„ç›¸å…³åº“å’Œé‡ç‚¹æ­¥éª¤ï¼Œè™½ç„¶æ²¡æœ‰ç‰¹åˆ«ç»†è‡´çš„è®²è§£ï¼Œä½†æ˜¯ç¼–ç¨‹æœ¬èº«å°±ä¸åº”è¯¥æ˜¯æŠŠé¥­å–‚åˆ°å˜´é‡Œçš„ï¼Œä½ åº”è¯¥æœ‰è‡ªå·±ç ”ç©¶çš„ä¸»åŠ¨æ€§ã€‚

## è‡ªåŠ¨éƒ¨ç½²æœåŠ¡å™¨
æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»‹ç»è‡ªå·±å¦‚ä½•è®©è¿™ä¸ªé¡¹ç›®ï¼Œæ¯æ¬¡å‘å¸ƒåˆ†æ”¯ï¼Œä¼šè‡ªåŠ¨éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸­

### é¦–å…ˆä½ å¾—æœ‰ä¸ªè‡ªå·±æœåŠ¡å™¨
 å¦‚ä½•æ‹¥æœ‰ä¸€ä¸ªæœåŠ¡å™¨ï¼Œä¸å¤šèµ˜è¿°ï¼Œé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰éƒ½æ˜¯å›½å†…æ¯”è¾ƒç®€å•ä¸”ä»·æ ¼è¿˜ç®—å¯ä»¥æ¥å—çš„ã€‚ä½ å¦‚æœåªæ˜¯ä¸ºäº†åšå®¢ï¼Œæ‰¾æœ€ä¾¿å®œçš„å°±å®Œå…¨è¶³å¤Ÿäº†ã€‚
 ç›¸å…³é‡è¦ç‚¹
 - æœåŠ¡å™¨
 - åŸŸå
 - å¤‡æ¡ˆä¿¡æ¯
 - SSLè¯ä¹¦
è¿™äº›ç½‘ä¸Šæœ‰å¾ˆå¤šè¯¦ç»†çš„æ•™ç¨‹ï¼ŒæœåŠ¡å™¨çš„SSLè¯ä¹¦å’Œnginxé…ç½®ä»€ä¹ˆçš„ï¼Œä½ å¯ä»¥ä½¿ç”¨[å®å¡”](https://www.bt.cn/new/index.html)è¿™ä¸ªè½¯ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œã€‚

### å®‰å…¨éªŒè¯é…ç½®
å…¶æ¬¡ï¼Œä½ éœ€è¦æœ¬æœºç”Ÿæˆå¯†é’¥å¯¹ï¼Œç§é’¥åœ¨æœ¬åœ°ï¼Œå…¬é’¥æ”¾åˆ°ä½ çš„æœåŠ¡å™¨ä¸­
å¦‚æœä½ æœ‰ï¼Œå¯ä»¥ç”¨å·²ç»å­˜åœ¨çš„å…¬é’¥æ”¾åˆ°æœåŠ¡å™¨ä¸­ï¼Œæ²¡æœ‰å°±è¦ç”Ÿæˆã€‚
githubä¸­ä¹Ÿè¦ä½ è¿™ä¸ªå…¬é’¥ï¼Œä¹Ÿéœ€è¦ä¸Šä¼ åˆ°githubä¸­

#### ç”Ÿæˆå¯†é’¥å¯¹
```
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```
è·ŸéšæŒ‡å¼•ç”Ÿæˆ é»˜è®¤ä½ç½®å› ç³»ç»Ÿä¸åŒè€Œä¸åŒï¼Œç½‘ä¸ŠæŸ¥ä¸€ä¸‹å°±çŸ¥é“äº†
ç§é’¥ä¸€èˆ¬æ˜¯æ²¡åç¼€ï¼Œå…¬é’¥ä¸€èˆ¬æ˜¯.pub
#### ç™»å½•åˆ°æœåŠ¡å™¨

```
ssh ä½ çš„æœåŠ¡å™¨ç”¨æˆ·å@ä½ çš„æœåŠ¡å™¨ipåœ°å€
```
#### åˆ›å»ºä¸€ä¸ª.sshç›®å½•ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
```
mkdir -p ~/.ssh
```
#### å…¬é’¥ä¸Šä¼ åˆ°æœåŠ¡å™¨
åœ¨æœåŠ¡å™¨ä¸Šï¼Œä½ éœ€è¦å°†å…¬é’¥è¿½åŠ åˆ° ~/.ssh/authorized_keys æ–‡ä»¶ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ cat å‘½ä»¤æ¥è¿½åŠ å†…å®¹ï¼š
```
cat >> ~/.ssh/authorized_keys

```
ç„¶åï¼Œå°†æœ¬æœºçš„å…¬é’¥å†…å®¹å¤åˆ¶åˆ°ç»ˆç«¯ä¸­ï¼Œå¹¶ç²˜è´´åˆ° authorized_keys æ–‡ä»¶ä¸­ã€‚
#### è®¾ç½®æƒé™
```
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```
#### ä½ å¯ä»¥æµ‹è¯•ä¸€ä¸‹é“¾æ¥
```
ssh -i ~/.ssh/ä½ çš„å¯†é’¥åç§°ï¼Œå¯ä»¥å»ä½ ç”Ÿæˆä½ç½®æ‰¾ user@server_ip

```
#### å…¬é’¥æ”¾åˆ°ä½ çš„GitHub Secrets
å¦‚æœä½ æ˜¯ä¸ºäº† GitHub Actions ä½¿ç”¨ SSH å¯†é’¥ï¼Œå¯ä»¥å°†å…¬é’¥å’Œç§é’¥å­˜å‚¨åˆ° GitHub Secretsï¼š
ä½ç½®ï¼šSettings > Secrets and variables > Actionsï¼š>Repository secrets
1. å°†ç§é’¥å­˜å‚¨ä¸º SSH_PRIVATE_KEYï¼š åŒæ ·åœ¨ GitHub Secrets ä¸­ï¼Œå°†ç§é’¥å†…å®¹å­˜å‚¨ä¸º SSH_PRIVATE_KEYã€‚
2. ä½ çš„ç”¨æˆ·åä¹Ÿæ”¾è¿›å» SERVER_USER
3. ä»¥åŠä½ æœåŠ¡å™¨ipåœ°å€ï¼šSERVER_IP
è¿™äº›éƒ½æ˜¯å˜é‡åç§°ï¼Œåé¢ä¼šç”¨åˆ°
è¿™æ ·ï¼Œåœ¨ GitHub Actions ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è®¿é—®è¿™äº› Secrets æ¥å®‰å…¨åœ°ä½¿ç”¨ SSH å¯†é’¥å¯¹ã€‚

### æœåŠ¡å™¨ä¸­çš„nginxé…ç½®éƒ¨ç½²ä½ çš„é¡¹ç›®
ä½ å¯ä»¥ç½‘ä¸Šæ‰¾æ›´ç®€å•è¯¦ç»†çš„æ•™ç¨‹ï¼Œä¹Ÿå¯ä»¥ç”¨å®å¡”ã€‚
ä½¿ç”¨å®å¡”çš„è¯ï¼Œä½ å¯ä»¥ç›´æ¥ç”¨å…¶æ¨¡æ¿è¿›è¡Œé…ç½®ï¼Œç„¶åæ‰‹åŠ¨æ‰˜æ–‡ä»¶è¿‡å»éƒ¨ç½²ã€‚
å½“ç„¶è¿™ä¸€åˆ‡å‰ææ˜¯ä½ å®Œæˆäº†ä¸Šé¢éƒ¨ç½²å‰çš„ä¸€åˆ‡éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯å¤‡æ¡ˆå’ŒSSL

## æœ€åæ˜¯é‡ç‚¹
å¦‚æœä½ å·²ç»å®Œæˆäº†ä½ åšå®¢çš„éƒ¨ç½²ï¼Œä¸”é…ç½®å¥½äº†å¯†é’¥å¯¹ç›¸å…³å†…å®¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¿›è¡Œå¯¹github actionsçš„æ–°çš„ä¸€é¡¹ä»»åŠ¡æ·»åŠ 
```yaml
     - name: Deploy to Server
        env:
          DEPLOY_SSH_KEY: ${{ secrets.SSH_PRIVATE_KEY }}  # ä½¿ç”¨ SSH å¯†é’¥è¿›è¡Œå®‰å…¨è¿æ¥
          SERVER_USER: ${{ secrets.SERVER_USER }}
          SERVER_IP: ${{ secrets.SERVER_IP }}  # æœåŠ¡å™¨ IP åœ°å€
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -H $SERVER_IP >> ~/.ssh/known_hosts

          # è®¾ç½® SSH å¯†é’¥
          echo "$DEPLOY_SSH_KEY" > private_key.pem
          chmod 600 private_key.pem

          # å°†æ„å»ºåçš„æ–‡ä»¶é€šè¿‡ SCP ä¸Šä¼ åˆ°æœåŠ¡å™¨
          scp -i private_key.pem -r ./docs/.vuepress/dist/* $SERVER_USER@$SERVER_IP:/www/wwwroot/inksnowhl.cn  # å‡è®¾æ„å»ºè¾“å‡ºç›®å½•ä¸º ./dist

          # åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤ï¼Œæ›´æ–°å‰ç«¯æœåŠ¡
          ssh -i private_key.pem $SERVER_USER@$SERVER_IP << EOF
            # ç¡®ä¿ Nginx å·²ç»é…ç½®å¥½
            sudo systemctl reload nginx  # å¦‚æœ Nginx é…ç½®æ–‡ä»¶æœ‰æ”¹åŠ¨ï¼Œé‡è½½ Nginx
          EOF

```
è¿™ä¸€æ®µä»»åŠ¡ï¼Œä½ å¯ä»¥æ·»åŠ åˆ°ä½ çš„ä¹‹å‰çš„github çš„actionä¸­ï¼Œè¿™é‡Œé¢è°ƒç”¨äº†ä½ åœ¨secretsé…ç½®çš„é‚£äº›ç¯å¢ƒå˜é‡ã€‚
å½“ä½ ä¸Šä¼ gitåˆ†æ”¯ï¼Œè¿™ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œä¾¿ä¼šä¸Šä¼ åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œå®ç°äº†è‡ªåŠ¨éƒ¨ç½²ã€‚
